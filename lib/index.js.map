{"version":3,"file":"index.js","sources":["../src/stories/Video.tsx"],"sourcesContent":["import React from \"react\";\nimport { ChangeEvent, useEffect, useRef, useState } from \"react\";\nimport Hls, { Level } from \"hls.js\";\n// import \"./video.css\";\n\ninterface VideoProps extends HTMLVideoElement {\n  drmSystemConfig?: object;\n  hls?: Hls;\n}\n\nconst Video = ({ drmSystemConfig, ...props }: VideoProps): JSX.Element => {\n  const videoRef = useRef<VideoProps>(null);\n  const [bitRates, setBitRates] = useState<number[]>([]);\n  const [selectedBitRate, setSelectedBitRate] = useState<number>(0);\n\n  useEffect(() => {\n    const video = videoRef.current;\n    if (!video) {\n      console.log(\"video player not mounted\");\n      return;\n    }\n\n    if (!video.src) {\n      console.log(\"no video source passed\", props);\n      return;\n    }\n\n    console.log(video);\n    console.log(video.src);\n\n    if (Hls.isSupported()) onHLSSupported(video);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  function onHLSSupported(video: VideoProps) {\n    const hls = new Hls({ drmSystems: drmSystemConfig });\n    video.hls = hls;\n    hls.loadSource(video.src);\n    hls.attachMedia(video);\n    hls.on(Hls.Events.MANIFEST_PARSED, () => {\n      loadBitRates(hls);\n    });\n  }\n\n  function loadBitRates(hls: Hls) {\n    const bitRateLevels = hls.levels.map((level: Level) => level.height);\n    setBitRates(bitRateLevels);\n    setSelectedBitRate(hls.levels.length - 1);\n  }\n\n  console.log(bitRates);\n  console.log(selectedBitRate);\n\n  const onBitRateChange = (event: ChangeEvent<HTMLSelectElement>) => {\n    const newBitRate = parseInt(event.target.value);\n    const video = videoRef.current;\n\n    if (!video) return;\n    if (video.readyState === video.HAVE_ENOUGH_DATA) {\n      const hls = video.hls;\n      if (hls && hls.levels[newBitRate]) {\n        hls.currentLevel = newBitRate;\n      }\n    }\n\n    setSelectedBitRate(newBitRate);\n  };\n\n  return (\n    <div className=\"video-player-wrapper\">\n      {/* <video ref={videoRef} {...props}></video> */}\n      {bitRates && (\n        <select\n          className=\"bitrate-select\"\n          value={selectedBitRate}\n          onChange={onBitRateChange}\n        >\n          {bitRates.map((bitRate: number, index: number) => (\n            <option key={index} value={index}>\n              {bitRate}p\n            </option>\n          ))}\n        </select>\n      )}\n    </div>\n  );\n};\n\nexport default Video;\n"],"names":[],"mappings":"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"}